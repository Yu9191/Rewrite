/* 
12.15
^https?:\/\/(m\.kugou\.com|gateway(retry)?\.kugou\.com|ads\.service\.kugou\.com|welfare\.kugou\.com|fx\.service\.kugou\.com|hwstore\.kugou\.com|loginservice\.kugou\.com|expendablekmrcdnretry\.kugou\.com)\/(ssr\/decocenter\/home|v5\/login_by_token|v2\/get_login_extend_info|card\/v1\/pxy\/top|ads\.gateway\/v2\/sidebar_link|ads\.gateway\/v2\/sidebar_top_card|ads\.gateway\/v2\/home_card|mobile\/vipinfoV2|v4\/mobile_splash(_sort)?|v2\/get_vip_config|ads\.gateway\/v5\/task_video\/qualification|els\.abt\/v1\/tmeab|pxy\/v1\/combo\/startup|mstc\/musicsymbol\/v1\/system\/profile|pendant\/v2\/get_user_pendant|v1\/blindbox_cabinet\/client_cabinet|ads\.gateway\/v2\/mobile_link|card\/v1\/pxy\/listen|flow\/user_config\/get_level_config_ios|v1\/starlight\/get_campaign_infos|searchnofocus\/v1\/search_no_focus_word|updateservice\/v1\/get_dev_user|v1\/login_by_quick_token|card\/v1\/pxy\/recommend_stream(_v2)?|v1\/get_res_privilege\/lite|v1\/union\/audio_info|ads\.gateway\/v2\/task_center_entrance|ocean\/v6\/theme\/category|tools\.mobile\/v2\/theme\/info|promotionvip\/v3\/vip_level\/detail) url script-response-body http://192.168.1.100:9191/kugou.js

hostname = m.kugou.com, gateway.kugou.com, gatewayretry.kugou.com, ads.service.kugou.com, welfare.kugou.com, fx.service.kugou.com, hwstore.kugou.com, loginservice.kugou.com, expendablekmrcdnretry.kugou.com
 *
*/

const url=$request.url;let body=$response.body;const vipDate="2099-09-09 09:09:09";const beginDate="2024-01-01 00:00:00";const vipToken="1234567890abcdef";const vipFields={is_vip:1,vip_type:6,y_type:1,user_type:29,m_type:1,vip_token:vipToken,auth_token:vipToken,vip_end_time:vipDate,vip_begin_time:beginDate,m_end_time:vipDate,m_begin_time:beginDate,su_vip_end_time:vipDate,su_vip_begin_time:beginDate,su_vip_y_endtime:vipDate,roam_end_time:vipDate,listen_end_time:vipDate,bookvip_end_time:vipDate,su_vip_clearday:vipDate,roam_type:1,is_first:0,svip_level:9,svip_score:9999,bookvip_valid:1};function traverse(e){if("object"!=typeof e||null===e)return;for(let i in e)"is_vip"===i||"vip_type"===i||"m_type"===i||"y_type"===i||"user_type"===i||"is_special_vip"===i||"vip_switch"===i||"bookvip_valid"===i?"vip_type"===i?e[i]=6:"user_type"===i?e[i]=29:e[i]=1:"vip_token"===i||"auth_token"===i?e[i]=vipToken:i.endsWith("_end_time")||i.endsWith("_endtime")||"su_vip_clearday"===i?e[i]=vipDate:i.endsWith("_begin_time")||"reg_time"===i?e[i]=beginDate:"valid"===i||"is_original"===i?e[i]=!0:"privilege"===i?e[i]=1:"pay_type"===i?e[i]=0:"roam_list"===i?e[i]={gd:1}:"svip_level"===i?e[i]=9:("ads"===i&&!url.includes("search_no_focus_word")&&!url.includes("task_center_entrance")||"ad_info"===i||"mobile_link"===i||"blindbox_list"===i||"task"===i||"info"===i&&Array.isArray(e[i])&&url.includes("mobile_link")?e[i]=[]:i.includes("ad_value")||i.includes("audioad")||i.includes("video_max_times")||i.includes("expire_prompt")||i.includes("already_expire")?e[i]=0:"global"===i&&url.includes("profile")?e[i]&&(e[i].open=0,e[i].shortplay_entrance_open=0):"pendant_id"===i||"flicker_pendant_id"===i?e[i]=0:"boot_ads"===i||"front_ads"===i||"least_ads"===i?e[i]=[]:"popup"===i?e[i]=null:"fail_process"===i&&(e[i]=0)),traverse(e[i])}const processThemes=e=>{if(e)for(let i of e)(i.vip_level=6,i.privilege=0,i.privileges=[0],i.limit_free_info&&(i.limit_free_info.limit_free_status=1,i.limit_free_info.free_end_time=4092599349,i.limit_free_info.toast_content="已解锁 SVIP 9 尊享皮肤"),i.price&&(i.price=0),i.themes&&processThemes(i.themes))};function main(){if(!body)return null;try{if(/ssr\/decocenter\/home/.test(url)){let e=/<script id="__NEXT_DATA__" type="application\/json">(.+?)<\/script>/,i=body.match(e);if(i&&i[1])try{let t=JSON.parse(i[1]);if(t.props&&t.props.pageProps){let s=t.props.pageProps;s.state&&s.state.vipInfo&&(s.state.vipInfo.isVip=1,s.state.vipInfo.isSvip=1,s.state.vipInfo.level=9,s.state.vipInfo.user_type=29),s.funsionData&&s.funsionData.vipInfo&&(Object.assign(s.funsionData.vipInfo,vipFields),s.funsionData.vipInfo.is_vip=1,s.funsionData.vipInfo.vip_type=6,s.funsionData.vipInfo.user_type=29,s.funsionData.vipInfo.svip_level=9)}let s=JSON.stringify(t),a=body.replace(e,`<script id="__NEXT_DATA__" type="application/json">${s}<\/script>`);return{body:a}}catch(e){}return null}let e=JSON.parse(body),i=!1;if(/task_center_entrance/i.test(url)){let t="联合国儿童基金会",s="https://t.me/Jsforbaby";if(e&&e.data&&e.data.ads){let a=e.data.ads;for(let p=0;p<a.length;p++){let l=a[p];l.title&&(l.title=t),l.main_heading&&(l.main_heading=t),l.entrance_name&&(l.entrance_name=t),l.desc&&(l.desc="立即查看"),l.jumpLink&&(l.jumpLink=s)}}i=!0}else if(/theme\/(category|info)/i.test(url))e&&e.data&&(e.data.info&&e.data.info.forEach(e=>{e.themes&&processThemes(e.themes)}),e.data.themes&&processThemes(e.data.themes),/theme\/info/i.test(url)&&processThemes([e.data])),i=!0;else if(/promotionvip\/v3\/vip_level\/detail/i.test(url)&&e.data)e.data.growth=999999,e.data.grade=9,e.data.level_start_growth=3e5,e.data.next_level_growth=1e6,i=!0;else if(/get_res_privilege\/lite/i.test(url)&&e.data&&Array.isArray(e.data)){let t=s=>{s.status=1,s.fail_process=0,s.pay_type=0,s.price=0,s.pkg_price=0,s.privilege=10,s.popup=null,s.trans_param&&(s.trans_param.musicpack_advance=0,s.trans_param.pay_block_tpl=0,s.trans_param.display=0,s.trans_param.display_rate=0,s.trans_param.all_quality_free=1,s.trans_param.free_limited=0,s.trans_param.download_privilege=8,s.trans_param.classmap={attr0:234881032})};e.data.forEach(e=>t(e)),e.relate_goods&&Array.isArray(e.relate_goods)&&e.relate_goods.forEach(e=>t(e)),e.userinfo&&(e.userinfo.vip_type=6,e.userinfo.m_type=1,e.userinfo.vip_user_type=3,e.userinfo.quota_remain=999),void 0!==e.vip_user_type&&(e.vip_user_type=3),i=!0}else/union\/audio_info/i.test(url)&&e.data?(traverse(e.data),i=!0):e.data&&Array.isArray(e.data.responses)?(e.data.responses.forEach(e=>{if(e.body&&"string"==typeof e.body&&("{"===e.body.startsWith||"["===e.body.startsWith))try{let t=JSON.parse(e.body);traverse(t),t.data&&t.data.song_list&&t.data.song_list.forEach(e=>{e.privilege=1,e.pay_type=0,e.popup=null,e.trans_param&&(e.trans_param.musicpack_advance=0,e.trans_param.all_quality_free=1,e.trans_param.free_limited=0)}),e.body=JSON.stringify(t),i=!0}catch(e){}}),i=!0):e.data&&e.data.TmeabConfigs&&"string"==typeof e.data.TmeabConfigs?(()=>{try{let t=JSON.parse(e.data.TmeabConfigs);traverse(t);const s={TMEAB0MyFavorite0adbanner:{else_ad_show:"0"},TMEAB0playpage0admanagement:{add:"0"},TMEAB0huiyuan0wangzhuancard:{card:"0"},TMEAB0huiyuan0wangzhuanzidong:{shouye_is_open:"0"}};for(let a in s)t[a]&&t[a].mapParams&&Object.assign(t[a].mapParams,s[a]);e.data.TmeabConfigs=JSON.stringify(t),i=!0}catch(e){}})(i=!0):(/login_by_token/i.test(url)||/get_login_extend_info/i.test(url)||/get_dev_user/i.test(url)||/login_by_quick_token/i.test(url)||/mobile\/vipinfoV2/i.test(url)||/get_vip_config/i.test(url))&&e.data?(Object.assign(e.data,vipFields),e.data.vipinfo&&Object.assign(e.data.vipinfo,vipFields),i=!0):/searchnofocus\/v1\/search_no_focus_word/i.test(url)&&e.data&&e.data.ads?(e.data.ads=e.data.ads.filter(e=>0===e.id&&0===e.is_preview&&103!==e.type),e.data.fallback&&(e.data.fallback=e.data.fallback.filter(e=>0===e.id)),i=!0):/starlight\/get_campaign_infos/i.test(url)&&e.data?(e.data=[],i=!0):/flow\/user_config\/get_level_config_ios/i.test(url)&&e.data?(e.data.user&&e.data.user.forEach(e=>{0===e.userLevelId&&(e.userLevelName="自定义神",e.kg.iconType=1,e.fx.iconType=1)}),e.data.star&&e.data.star.forEach(e=>{0===e.starLevelId&&(e.starLevelName="神话5级",e.kg.iconType=1,e.fx.iconType=1)}),i=!0):/playerpxy\/v1\/combo\/play_page_index/i.test(url)&&e.data&&e.data.modules?(traverse(e.data),i=!0):/adp\/ad\/v1\/playpage_combine/i.test(url)?(e.data={},i=!0):/v3\/vip_center/i.test(url)?(e.data=[],i=!0):/ads\.gateway\/v4\/search_banner/i.test(url)?(e.data=[],i=!0):/mine_top_banner/i.test(url)?(e.data=[],i=!0):/card\/v1\/pxy\/listen/i.test(url)?(e.data=[],i=!0):(traverse(e),i=!0);let t=JSON.stringify(e);return t=t.replace(/"is_vip"\s*:\s*0/g,'"is_vip":1').replace(/"vip_type"\s*:\s*0/g,'"vip_type":6').replace(/"user_type"\s*:\s*0/g,'"user_type":29').replace(/"m_type"\s*:\s*0/g,'"m_type":1').replace(/"y_type"\s*:\s*0/g,'"y_type":1').replace(/"valid"\s*:\s*false/g,'"valid":true').replace(/"vip_begin_time"\s*:\s*""/g,`"${beginDate}"`).replace(/"su_vip_begin_time"\s*:\s*""/g,`"${beginDate}"`).replace(/"m_begin_time"\s*:\s*""/g,`"${beginDate}"`),/theme\/(category|info)/i.test(url)||(t=t.replace(/"svip_level"\s*:\s*\d+/g,'"svip_level":9')),/get_res_privilege\/lite/i.test(url)||(t=t.replace(/"privilege"\s*:\s*(0|8)/g,'"privilege":1')),t=t.replace(/"pay_type"\s*:\s*3/g,'"pay_type":0').replace(/"fail_process"\s*:\s*4/g,'"fail_process":0').replace(/"popup"\s*:\s*{[^}]+}/g,'"popup":null'),{body:t}}catch(e){return console.log("[Kugou_Error] "+e.message),null}}let res=main();res?$done(res):$done({});
